<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OST - Omar's Speech Teacher</title>
    <meta name="description" content="Interactive learning platform for speech and language development">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Poppins:wght@400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <span class="logo-icon">üìö</span>
                <span class="logo-text">OST</span>
            </div>
            <div class="nav-links">
                <button class="nav-btn active" data-page="home">
                    <span class="nav-icon">üè†</span>
                    <span>Home</span>
                </button>
                <button class="nav-btn" data-page="stories">
                    <span class="nav-icon">üìñ</span>
                    <span>Stories</span>
                </button>
                <button class="nav-btn" data-page="practice">
                    <span class="nav-icon">üé§</span>
                    <span>Practice</span>
                </button>
                <button class="nav-btn" data-page="quiz">
                    <span class="nav-icon">üéØ</span>
                    <span>Quiz</span>
                </button>
                <button class="nav-btn" data-page="chat">
                    <span class="nav-icon">üí¨</span>
                    <span>Chat</span>
                </button>
                <button class="nav-btn" data-page="recall">
                    <span class="nav-icon">üß†</span>
                    <span>Daily</span>
                </button>
                <button class="nav-btn" data-page="tinystories">
                    <span class="nav-icon">üß∏</span>
                    <span>Read & Learn</span>
                </button>
                <button class="nav-btn" data-page="vocabulary">
                    <span class="nav-icon">üìö</span>
                    <span>Words</span>
                </button>
                <button class="nav-btn" data-page="scramble">
                    <span class="nav-icon">üß©</span>
                    <span>Scramble</span>
                </button>
                <button class="nav-btn" data-page="achievements">
                    <span class="nav-icon">üèÜ</span>
                    <span>Badges</span>
                </button>
                <button class="nav-btn" id="settings-btn">
                    <span class="nav-icon">‚öôÔ∏è</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Home Page -->
        <section id="home-page" class="page active">
            <div class="hero-section">
                <div class="hero-content">
                    <h1 class="hero-title">
                        Welcome, <span class="highlight">Omar</span>! üåü
                    </h1>
                    <p class="hero-subtitle">
                        Let's learn, read, and speak together!
                    </p>

                    <!-- Daily Adventure Progress -->
                    <div class="daily-adventure-status">
                        <div class="adventure-header">
                            <span>üöÄ Today's Adventure</span>
                            <span id="adventure-progress-text">0/3 Missions</span>
                        </div>
                        <div class="adventure-progress-bar">
                            <div id="adventure-progress-fill" class="progress-fill" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="hero-cards">
                        <div class="hero-card" data-navigate="stories">
                            <div class="card-icon">üìö</div>
                            <h3>Read Stories</h3>
                            <p>Listen and read fun stories</p>
                        </div>
                        <div class="hero-card" data-navigate="practice">
                            <div class="card-icon">üé§</div>
                            <h3>Practice Speaking</h3>
                            <p>Speak and learn new words</p>
                        </div>
                        <div class="hero-card" data-navigate="quiz">
                            <div class="card-icon">üéØ</div>
                            <h3>Take Quiz</h3>
                            <p>Test what you learned</p>
                        </div>
                        <div class="hero-card" data-navigate="chat">
                            <div class="card-icon">üí¨</div>
                            <h3>Chat & Explore</h3>
                            <p>Ask and see new things</p>
                        </div>
                        <div class="hero-card" data-navigate="recall">
                            <div class="card-icon">üß†</div>
                            <h3>Daily Challenge</h3>
                            <p>Remember and write</p>
                        </div>
                        <div class="hero-card" data-navigate="tinystories">
                            <div class="card-icon">üß∏</div>
                            <h3>Read & Learn</h3>
                            <p>Generate & Learn</p>
                        </div>
                        <div class="hero-card" data-navigate="achievements">
                            <div class="card-icon">üèÜ</div>
                            <h3>My Badges</h3>
                            <p>See your unlocked rewards</p>
                        </div>
                        <div class="hero-card" data-navigate="scramble">
                            <div class="card-icon">üß©</div>
                            <h3>Story Builder</h3>
                            <p>Unscramble story sentences</p>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </section>

        <!-- Recall / Daily Page -->
        <section id="recall-page" class="page">
            <div class="page-header">
                <h1>üó∫Ô∏è Daily Adventure</h1>
                <p>Complete your missions to earn badges!</p>
            </div>

            <div class="recall-container">
                <!-- Mission List -->
                <div id="daily-missions-list" class="missions-grid">
                    <!-- Missions like "Read a Story", "Practice Words" etc -->
                    <div class="mission-card" id="mission-read">
                        <div class="mission-icon">üìñ</div>
                        <div class="mission-info">
                            <h3>Story Explorer</h3>
                            <p>Read one story today</p>
                        </div>
                        <div class="mission-status">‚è≥</div>
                    </div>
                    <div class="mission-card" id="mission-practice">
                        <div class="mission-icon">üé§</div>
                        <div class="mission-info">
                            <h3>Magic Words</h3>
                            <p>Practice speaking 3 new words</p>
                        </div>
                        <div class="mission-status">‚è≥</div>
                    </div>
                    <div class="mission-card" id="mission-chat">
                        <div class="mission-icon">üí¨</div>
                        <div class="mission-info">
                            <h3>Chat Buddy</h3>
                            <p>Say hello to Buddy in Chat</p>
                        </div>
                        <div class="mission-status">‚è≥</div>
                    </div>
                    <div class="mission-card" id="mission-scramble" style="cursor:pointer;">
                        <div class="mission-icon">üß©</div>
                        <div class="mission-info">
                            <h3>Story Builder</h3>
                            <p>Unscramble sentences from a story</p>
                        </div>
                        <div class="mission-status">‚è≥</div>
                    </div>
                </div>

                <div id="due-stories-list" class="stories-grid hidden">
                    <!-- Kept for compatibility but hidden -->
                </div>

                <div id="writing-exercise" class="writing-exercise hidden">
                    <button class="back-btn" id="back-to-recall">‚Üê Back to List</button>

                    <div class="exercise-card">
                        <h3>üß© Story Scramble: <span id="writing-story-title" class="highlight-text">...</span></h3>
                        <p style="text-align:center; color: var(--text-secondary); margin-bottom: 1rem;">Arrange the
                            jumbled words to rebuild the story, one sentence at a time!</p>
                    </div>

                    <div id="scramble-game" class="scramble-game-container">
                        <div class="scramble-progress"
                            style="text-align:center; margin-bottom: 1rem; font-weight: bold; font-size: 1.1rem;">
                            Sentence <span id="scramble-current">1</span> of <span id="scramble-total">?</span>
                        </div>

                        <div id="scramble-workspace" class="scramble-workspace">
                            <div class="placeholder-text">Click the words below to build the sentence!</div>
                        </div>

                        <div id="scramble-words" class="scramble-words-pool">
                            <!-- Shuffled words here -->
                        </div>

                        <div class="writing-controls" style="justify-content: center;">
                            <button id="check-scramble" class="control-btn primary">
                                <span class="btn-icon">‚úÖ</span>
                                <span>Check Sentence</span>
                            </button>
                            <button id="reset-scramble" class="control-btn">
                                <span class="btn-icon">üîÑ</span>
                                <span>Reset</span>
                            </button>
                        </div>
                    </div>

                    <div id="writing-feedback" class="writing-feedback hidden">
                        <h3 id="feedback-title"></h3>
                        <div id="feedback-message" style="margin-bottom: 1rem;"></div>
                        <button id="next-scramble" class="control-btn primary hidden" style="margin: 0 auto;">
                            <span>Next Sentence ‚û°Ô∏è</span>
                        </button>
                    </div>
                </div>
            </div>
            </div>
        </section>

        <!-- Stories Page -->

        <!-- Scramble Page (Standalone) -->
        <section id="scramble-page" class="page">
            <div class="page-header">
                <h1>üß© Story Builder</h1>
                <p>Unscramble sentences to rebuild stories word by word!</p>
            </div>

            <div class="recall-container">
                <!-- Story Picker -->
                <div id="scramble-story-picker">
                    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 1rem;">
                        Rebuild stories word by word! Choose your level:
                    </p>
                    <div
                        style="display: flex; gap: 0.75rem; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem;">
                        <button class="control-btn sp-diff-btn active" data-diff="easy" style="font-size: 0.95rem;">
                            üü¢ Easy (3-4 words)
                        </button>
                        <button class="control-btn sp-diff-btn" data-diff="medium" style="font-size: 0.95rem;">
                            üü° Medium (5-6 words)
                        </button>
                        <button class="control-btn sp-diff-btn" data-diff="hard" style="font-size: 0.95rem;">
                            üî¥ Hard (full sentences)
                        </button>
                    </div>
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <button id="scramble-random-btn" class="control-btn primary"
                            style="font-size: 1.1rem; padding: 0.8rem 2rem;">
                            <span>üé≤ Random Story</span>
                        </button>
                    </div>
                    <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Or pick a story:</h3>
                    <div id="scramble-stories-grid" class="stories-grid">
                        <p style="text-align:center; color:var(--text-secondary); grid-column: 1/-1;">Loading stories...
                        </p>
                    </div>
                </div>

                <!-- Scramble Game Area (standalone page version) -->
                <div id="scramble-game-area" class="hidden sp-game-viewport">
                    <!-- Compact header row: back + title -->
                    <div class="sp-top-row">
                        <button class="sp-back-btn" id="back-to-scramble-picker" title="Pick Another Story">‚Üê
                            Back</button>
                        <div class="sp-progress-badge">
                            Sentence <span id="sp-scramble-current">1</span> of <span id="sp-scramble-total">?</span>
                        </div>
                    </div>

                    <!-- Story writing pad -->
                    <div class="sp-story-pad">
                        <div class="sp-pad-header">
                            <span>üß© <span id="scramble-page-title">...</span></span>
                        </div>
                        <div id="sp-story-text" class="sp-pad-content">
                            <span class="sp-pad-placeholder">Your story will appear here as you build it, word by
                                word...</span>
                        </div>
                    </div>

                    <!-- Workspace: where user builds the sentence -->
                    <div id="sp-scramble-workspace" class="scramble-workspace sp-compact-workspace">
                        <div class="placeholder-text">Click the words below to build the sentence!</div>
                    </div>

                    <!-- Word pool -->
                    <div id="sp-scramble-words" class="scramble-words-pool sp-compact-pool"></div>

                    <!-- Controls row: Check, Reset, feedback, Next ‚Äî all inline -->
                    <div class="sp-controls-row">
                        <button id="sp-check-scramble" class="control-btn primary sp-compact-btn">
                            <span class="btn-icon">‚úÖ</span> Check
                        </button>
                        <button id="sp-reset-scramble" class="control-btn sp-compact-btn">
                            <span class="btn-icon">üîÑ</span> Reset
                        </button>
                        <div id="sp-writing-feedback" class="sp-inline-feedback hidden">
                            <span id="sp-feedback-title"></span>
                            <span id="sp-feedback-message"></span>
                        </div>
                        <button id="sp-next-scramble" class="control-btn primary sp-compact-btn hidden">
                            Next ‚û°Ô∏è
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stories Page -->
        <section id="stories-page" class="page">
            <div class="page-header">
                <h1>üìñ Story Time</h1>
                <p>Choose a story to read and listen</p>
            </div>

            <!-- Story Generator -->
            <div class="story-generator">
                <h3>‚ú® Create New Story</h3>
                <div class="generator-controls">
                    <div class="generator-row">
                        <input type="text" id="story-topic" class="topic-input"
                            placeholder="Enter a topic (e.g., animals, space, friendship)...">
                        <button id="generate-random-story" class="generate-btn">
                            <span>üé≤</span>
                            <span>Random Story</span>
                        </button>
                    </div>

                    <div class="generator-row">
                        <div class="length-buttons">
                            <span style="color: var(--text-secondary); margin-right: 0.5rem;">Length:</span>
                            <button class="length-btn active" data-length="short">üìù Short (50 words)</button>
                            <button class="length-btn" data-length="medium">üìÑ Medium (100 words)</button>
                            <button class="length-btn" data-length="long">üìö Long (150-180 words)</button>
                        </div>
                    </div>

                    <div class="generator-row">
                        <div class="settings-option">
                            <span style="color: var(--text-secondary); margin-right: 0.5rem;">Voice Speed:</span>
                            <select id="gen-speed" class="form-select"
                                style="background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--border-color); padding: 5px; border-radius: 8px;">
                                <option value="0.6">Slow (0.6x)</option>
                                <option value="0.8" selected>Normal (0.8x)</option>
                                <option value="1.0">Fast (1.0x)</option>
                            </select>
                        </div>
                        <div class="settings-option" style="margin-left: 1rem;">
                            <span style="color: var(--text-secondary); margin-right: 0.5rem;">Language:</span>
                            <select id="gen-language" class="form-select"
                                style="background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--border-color); padding: 5px; border-radius: 8px;">
                                <option value="en" selected>English Only</option>
                                <option value="hi">English + Hindi üáÆüá≥</option>
                                <option value="es">English + Spanish üá™üá∏</option>
                                <option value="fr">English + French üá´üá∑</option>
                                <option value="de">English + German üá©üá™</option>
                            </select>
                        </div>
                    </div>

                    <div class="generator-row" style="justify-content: center;">
                        <button id="generate-topic-story" class="generate-btn">
                            <span>‚ú®</span>
                            <span>Generate Story</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Story Management Controls -->
            <div class="story-management">
                <button id="toggle-select-mode" class="control-btn">
                    <span class="btn-icon">‚òëÔ∏è</span>
                    <span>Manage Stories</span>
                </button>
                <button id="delete-selected" class="control-btn danger hidden">
                    <span class="btn-icon">üóëÔ∏è</span>
                    <span>Delete Selected</span>
                </button>
            </div>

            <div id="stories-list" class="stories-grid">
                <!-- Stories will be loaded here -->
            </div>

            <!-- Story Reader (two layouts: classic and step-by-step) -->
            <div id="story-reader" class="story-reader hidden">
                <div class="story-reader-header">
                    <button class="back-btn" id="back-to-stories">‚Üê Back to Stories</button>
                    <div class="play-mode-row">
                        <span class="play-mode-label">Manual</span>
                        <label class="toggle-switch"
                            title="Manual: you tap Play/Next. Automated: story plays and advances by itself.">
                            <input type="checkbox" id="play-mode-auto" aria-label="Automated play">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="play-mode-label">Automated</span>
                    </div>
                </div>

                <!-- Classic layout: one image, full story, play/pause -->
                <div id="story-reader-classic" class="story-reader-layout">
                    <div class="story-image-container">
                        <img id="story-image" src="" alt="Story Image" class="story-image">
                    </div>
                    <div class="story-content">
                        <h2 id="story-title" class="story-title"></h2>
                        <div class="story-controls">
                            <button id="play-story" class="control-btn primary">
                                <span class="btn-icon">‚ñ∂Ô∏è</span>
                                <span>Play English</span>
                            </button>
                            <button id="play-translation" class="control-btn secondary hidden">
                                <span class="btn-icon">üó£Ô∏è</span>
                                <span>Play Translation</span>
                            </button>
                            <button id="pause-story" class="control-btn" style="display: none;">
                                <span class="btn-icon">‚è∏Ô∏è</span>
                                <span>Pause</span>
                            </button>
                            <button id="stop-story" class="control-btn">
                                <span class="btn-icon">‚èπÔ∏è</span>
                                <span>Reset</span>
                            </button>
                        </div>
                        <div class="story-layout-container">
                            <div class="story-main-column">
                                <div id="story-text" class="story-text"></div>
                                <div id="story-moral" class="story-moral hidden">
                                    <h3>üåü Moral of the Story</h3>
                                    <p id="moral-text"></p>
                                </div>
                            </div>
                            <div class="story-sidebar-column">
                                <div id="story-vocab" class="story-vocab hidden">
                                    <h3>üìö New Words</h3>
                                    <div id="vocab-list" class="vocab-list-vertical"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step-by-step layout: one sentence + image at a time, Back/Next, language choice -->
                <div id="story-reader-step" class="story-reader-layout hidden">
                    <div id="step-language-choice" class="step-language-choice hidden">
                        <p class="step-language-prompt">Listen to the story in:</p>
                        <div class="step-language-buttons">
                            <button id="step-listen-english" class="control-btn primary">Listen in English</button>
                            <button id="step-listen-translation" class="control-btn secondary hidden">Listen in <span
                                    id="step-translation-lang">Hindi</span></button>
                        </div>
                    </div>
                    <div class="step-by-step-viewport">
                        <h2 id="step-story-title" class="step-story-title"></h2>
                        <div class="step-image-container">
                            <img id="step-sentence-image" src="" alt="Sentence illustration"
                                class="step-sentence-image">
                            <div id="step-image-placeholder" class="step-image-placeholder">üñºÔ∏è</div>
                        </div>
                        <div class="step-text-container">
                            <h3 id="step-moral-heading" class="step-moral-heading hidden">Moral of the Story</h3>
                            <p id="step-sentence-text" class="step-sentence-text"></p>
                            <p id="step-sentence-translation" class="step-sentence-translation hidden"></p>
                        </div>
                        <div id="step-controls-nav" class="step-controls">
                            <button id="step-back" class="control-btn hidden">
                                <span class="btn-icon">‚¨ÖÔ∏è</span>
                                <span>Back</span>
                            </button>
                            <button id="step-play-sentence" class="control-btn primary hidden">
                                <span class="btn-icon">‚ñ∂Ô∏è</span>
                                <span>Play</span>
                            </button>
                            <button id="step-play-translation" class="control-btn secondary hidden">
                                <span class="btn-icon">üó£Ô∏è</span>
                                <span>Play translation</span>
                            </button>
                            <button id="step-next" class="control-btn primary">
                                <span>Next</span>
                                <span class="btn-icon">‚û°Ô∏è</span>
                            </button>
                        </div>
                        <div id="step-controls-end" class="step-controls hidden">
                            <button id="step-back-to-stories" class="control-btn primary">
                                <span class="btn-icon">üìö</span>
                                <span>Back to Stories</span>
                            </button>
                        </div>
                        <div id="step-progress" class="step-progress"></div>
                    </div>
                </div>
            </div>
            </div>
            </div>
        </section>

        <!-- Read & Learn Page -->
        <section id="tinystories-page" class="page">
            <div class="page-header">
                <h1>üß∏ Read & Learn</h1>
                <p>Generate stories instantly and test your knowledge!</p>
            </div>

            <div class="tinystories-container">
                <!-- Generator -->
                <div class="story-generator" id="ts-generator-box">
                    <div class="generator-row" style="justify-content: center; flex-wrap: wrap;">
                        <input type="text" id="ts-topic" class="topic-input"
                            placeholder="Topic (e.g. a friendly dog, space adventure)...">

                        <div class="settings-option" style="margin: 0 1rem; display: flex; align-items: center;">
                            <span
                                style="color: var(--text-secondary); margin-right: 0.5rem; white-space: nowrap;">Speed:</span>
                            <select id="ts-gen-speed" class="form-select"
                                style="background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--border-color); padding: 5px; border-radius: 8px;">
                                <option value="0.6">Slow (0.6x)</option>
                                <option value="0.7">0.7x</option>
                                <option value="0.8" selected>Normal (0.8x)</option>
                                <option value="1.0">Fast (1.0x)</option>
                            </select>
                        </div>

                        <button id="ts-generate-btn" class="generate-btn">
                            <span>‚ú®</span>
                            <span>Generate Story</span>
                        </button>
                        <button id="ts-random-btn" class="generate-btn secondary"
                            style="min-width: unset; padding: 10px 15px;">
                            <span>üé≤</span>
                        </button>
                    </div>
                </div>

                <!-- List -->
                <div id="ts-progress-container" class="generator-row" style="margin-bottom: 2rem; display: none;">
                    <div class="hero-card"
                        style="width: 100%; cursor: default; padding: 1rem; flex-direction: row; gap: 2rem; justify-content: space-around;">
                        <div style="text-align: center;">
                            <h4 style="margin:0; font-size: 1.5rem; color: #22c55e;" id="ts-learned-count">0</h4>
                            <p style="margin:0; font-size: 0.8rem; opacity: 0.8;">Words Learned</p>
                        </div>
                        <div style="text-align: center;">
                            <h4 style="margin:0; font-size: 1.5rem; color: var(--primary);" id="ts-seen-count">0</h4>
                            <p style="margin:0; font-size: 0.8rem; opacity: 0.8;">Total Words Seen</p>
                        </div>
                    </div>
                </div>

                <div id="ts-list" class="stories-grid">
                    <p class="text-center">Loading stories...</p>
                </div>

                <!-- Reader & Test -->
                <div id="ts-reader" class="story-reader hidden">
                    <div class="story-reader-header">
                        <button class="back-btn" id="ts-back-btn">‚Üê Back to List</button>
                        <button class="control-btn" id="ts-regen-assets-btn" style="margin-bottom: var(--spacing-lg);">
                            <span>‚ú®</span>
                            <span>Regenerate Assets</span>
                        </button>
                    </div>

                    <div class="story-reader-layout">
                        <div class="story-content" style="width: 100%;">
                            <h2 id="ts-title" class="story-title">...</h2>

                            <!-- Story Image & Audio -->
                            <div id="ts-featured-image-container" class="featured-image hidden"
                                style="max-width: 400px; margin: 0 auto 2rem;">
                                <img id="ts-featured-image" src="" alt="Story Illustration"
                                    style="width: 100%; border-radius: 1rem; box-shadow: var(--shadow-lg);">
                            </div>

                            <div id="ts-audio-player-container" class="audio-player-card hidden"
                                style="max-width: 400px; margin: 0 auto 2rem; padding: 1rem; background: var(--bg-secondary); border-radius: 1rem;">
                                <audio id="ts-audio-player" controls style="width: 100%;"></audio>
                            </div>

                            <div id="ts-text" class="story-text" style="margin-bottom: 2rem;"></div>

                            <button id="ts-start-test-btn" class="control-btn primary"
                                style="margin: 0 auto; display: block;">
                                <span>üìù Take Test</span>
                            </button>
                        </div>
                    </div>

                    <!-- Test section -->
                    <div id="ts-test-section" class="quiz-container hidden" style="margin-top: 2rem;">
                        <!-- Vocab -->
                        <div id="ts-vocab-box" class="story-vocab" style="margin-bottom: 2rem;">
                            <h3>üìö Vocabulary</h3>
                            <div id="ts-vocab-list" class="vocab-list"></div>
                        </div>

                        <!-- Moral -->
                        <div class="quiz-card" style="margin-bottom: 2rem;">
                            <h3>üåü Moral</h3>
                            <p id="ts-moral-text"
                                style="font-size: 1.2rem; text-align: center; color: var(--success); font-weight: bold;">
                            </p>
                        </div>

                        <!-- Fill in the blanks -->
                        <div class="quiz-card" style="margin-bottom: 2rem;">
                            <h3>‚úçÔ∏è Fill in the Blanks</h3>
                            <div id="ts-fib-list"></div>
                        </div>

                        <!-- MCQs -->
                        <div class="quiz-card" style="margin-bottom: 2rem;">
                            <h3>ü§î Multiple Choice Questions</h3>
                            <div id="ts-mcq-list"></div>
                        </div>

                        <!-- Moral Questions -->
                        <div class="quiz-card" style="margin-bottom: 2rem;">
                            <h3>ü§î Moral Understanding</h3>
                            <div id="ts-moral-q-list"></div>
                        </div>

                        <!-- Finish Button -->
                        <div class="text-center" style="margin-top: 2rem; margin-bottom: 3rem;">
                            <button id="ts-submit-quiz-btn" class="control-btn primary"
                                style="padding: 1rem 3rem; font-size: 1.2rem; margin: 0 auto;">
                                <span>üéâ Finish & Submit</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Practice Page -->
        <section id="practice-page" class="page">
            <div class="page-header">
                <h1>üé§ Speaking Practice</h1>
                <p>Read the sentence and speak it out loud</p>
            </div>

            <div class="practice-container">
                <div class="practice-card">
                    <div class="practice-sentence" id="practice-sentence">
                        Click "Start Practice" to begin
                    </div>

                    <div class="practice-controls">
                        <button id="start-practice" class="control-btn primary">
                            <span class="btn-icon">üéØ</span>
                            <span>Start Practice</span>
                        </button>
                        <button id="listen-sentence" class="control-btn">
                            <span class="btn-icon">üîä</span>
                            <span>Listen</span>
                        </button>
                        <button id="record-speech" class="control-btn record-btn">
                            <span class="btn-icon">üé§</span>
                            <span>Record Your Voice</span>
                        </button>
                    </div>

                    <div id="practice-feedback" class="practice-feedback hidden">
                        <!-- Feedback will appear here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Quiz Page -->
        <section id="quiz-page" class="page">
            <div class="page-header">
                <h1>üéØ Quiz Time</h1>
                <p>Answer questions about the stories</p>
            </div>

            <div class="quiz-container">
                <!-- Step 1: Select Story -->
                <div id="quiz-story-selection">
                    <h3>Select a story to take a quiz:</h3>
                    <div id="quiz-stories-list" class="stories-grid">
                        <!-- Loaded via JS -->
                    </div>
                </div>

                <!-- Step 2: Question Interface -->
                <div id="quiz-interface" class="hidden">
                    <button class="back-btn" id="quit-quiz">‚ùå Quit Quiz</button>

                    <div class="quiz-card">
                        <div class="quiz-progress">
                            Question <span id="quiz-current-num">1</span> of <span id="quiz-total-num">3</span>
                        </div>

                        <h2 id="quiz-question" class="quiz-question">...</h2>

                        <div id="quiz-options" class="quiz-options">
                            <!-- Options buttons -->
                        </div>

                        <div id="quiz-feedback" class="quiz-feedback hidden">
                            <div class="feedback-content">
                                <span id="feedback-icon"></span>
                                <h3 id="feedback-title"></h3>
                                <p id="feedback-message"></p>
                            </div>
                            <button id="quiz-next-btn" class="control-btn primary">
                                <span>Next Question</span>
                                <span class="btn-icon">‚û°Ô∏è</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Results -->
                <div id="quiz-results" class="hidden">
                    <div class="results-card text-center">
                        <div class="results-icon">üèÜ</div>
                        <h2>Quiz Complete!</h2>
                        <div class="score-display">
                            You got <span id="quiz-score">0</span> correct!
                        </div>
                        <p id="quiz-encouragement"></p>
                        <button id="quiz-home-btn" class="control-btn primary">
                            <span>Back to Stories</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chat Page -->
        <section id="chat-page" class="page">
            <div class="page-header">
                <h1>üí¨ Chat with Buddy</h1>
                <p>Talk to your AI friend!</p>
            </div>

            <div class="buddy-chat-container">
                <div id="buddy-messages" class="buddy-messages">
                    <!-- Buddy's messages will appear here -->
                    <div class="message buddy">
                        <div class="message-content">
                            Hi Omar! I'm Buddy. How are you today? üòä
                        </div>
                    </div>
                </div>

                <div class="chat-input-row">
                    <input type="text" id="buddy-input" class="chat-input" placeholder="Type a message to Buddy...">
                    <button id="buddy-send" class="chat-send-btn">
                        <span>Send</span>
                        <span class="btn-icon">üöÄ</span>
                    </button>
                    <button id="buddy-reset" class="control-btn mini" title="Start new conversation"
                        style="width: auto; padding: 0.8rem;">
                        <span>üîÑ Reset</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Vocabulary Page -->
        <section id="vocabulary-page" class="page">
            <div class="page-header">
                <h1>üìö My Word Collection</h1>
                <p>Master new words and build your vocabulary!</p>
            </div>

            <div class="vocab-stats"
                style="display: flex; gap: 1rem; margin-bottom: 2rem; justify-content: center; flex-wrap: wrap;">
                <div class="hero-card mini" style="padding: 1rem 1.5rem; cursor: default;">
                    <div style="font-size: 2rem;">‚≠ê</div>
                    <div id="vocab-total-count"
                        style="font-size: 1.5rem; font-weight: bold; color: var(--primary-light);">0</div>
                    <div style="font-size: 0.85rem; opacity: 0.7;">Total Words</div>
                </div>
                <div class="hero-card mini" style="padding: 1rem 1.5rem; cursor: default;">
                    <div style="font-size: 2rem;">üìñ</div>
                    <div id="vocab-learning-count"
                        style="font-size: 1.5rem; font-weight: bold; color: var(--warning-color);">0</div>
                    <div style="font-size: 0.85rem; opacity: 0.7;">Learning</div>
                </div>
                <div class="hero-card mini" style="padding: 1rem 1.5rem; cursor: default;">
                    <div style="font-size: 2rem;">‚úÖ</div>
                    <div id="vocab-mastered-count"
                        style="font-size: 1.5rem; font-weight: bold; color: var(--success-color);">0</div>
                    <div style="font-size: 0.85rem; opacity: 0.7;">Mastered</div>
                </div>
            </div>

            <!-- Filter Tabs -->
            <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1.5rem;">
                <button class="control-btn vocab-filter active" data-filter="all">All</button>
                <button class="control-btn vocab-filter" data-filter="new">üÜï New</button>
                <button class="control-btn vocab-filter" data-filter="learning">üìñ Learning</button>
                <button class="control-btn vocab-filter" data-filter="mastered">‚úÖ Mastered</button>
            </div>

            <div id="vocab-grid"
                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1rem; max-width: 900px; margin: 0 auto; padding: 0 1rem;">
                <p style="text-align:center; grid-column: 1/-1; color:var(--text-secondary);">Loading words...</p>
            </div>

            <!-- Flashcard Modal -->
            <div id="flashcard-modal" class="modal-overlay hidden">
                <div class="modal-content" style="max-width: 440px; text-align: center;">
                    <div class="modal-header">
                        <h2>üîç Word Explorer</h2>
                        <button class="control-btn" id="close-flashcard">‚ùå</button>
                    </div>

                    <div id="flashcard-element" class="flashcard-3d" onclick="flipFlashcard()">
                        <div class="flashcard-inner" id="flashcard-inner">
                            <div class="flashcard-face flashcard-front">
                                <h1 id="card-word" class="card-word-text">Word</h1>
                                <p style="color: var(--text-secondary); margin-top: 0.5rem;">Tap to see meaning</p>
                                <div id="card-seen-count" style="margin-top: 1rem; font-size: 0.85rem; opacity: 0.6;">
                                    Seen 0 times</div>
                            </div>
                            <div class="flashcard-face flashcard-back">
                                <h3 style="color: var(--success-color); margin-bottom: 0.5rem;">Meaning</h3>
                                <p id="card-meaning" style="font-size: 1.2rem; line-height: 1.5;">...</p>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <button id="vocab-mark-mastered" class="control-btn primary" style="flex: 1;">
                            <span>‚úÖ I Know This!</span>
                        </button>
                        <button id="vocab-mark-learning" class="control-btn" style="flex: 1;">
                            <span>üìñ Still Learning</span>
                        </button>
                    </div>

                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem; justify-content:center;">
                        <button id="vocab-prev" class="control-btn mini" style="padding: 0.5rem 1rem;">‚¨ÖÔ∏è Prev</button>
                        <button id="vocab-listen" class="control-btn mini" style="padding: 0.5rem 1rem;">üîä
                            Listen</button>
                        <button id="vocab-next" class="control-btn mini" style="padding: 0.5rem 1rem;">Next ‚û°Ô∏è</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Achievements Page -->
        <section id="achievements-page" class="page">
            <div class="page-header">
                <h1>üèÜ Trophy Room</h1>
                <p>Your collection of earned badges and milestones!</p>
            </div>

            <!-- Progress Stats -->
            <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap;">
                <div class="hero-card mini" style="padding: 1rem 1.5rem; cursor: default;">
                    <div style="font-size: 2rem;">üèÖ</div>
                    <div id="badge-unlocked-count"
                        style="font-size: 1.5rem; font-weight: bold; color: var(--success-color);">0</div>
                    <div style="font-size: 0.85rem; opacity: 0.7;">Unlocked</div>
                </div>
                <div class="hero-card mini" style="padding: 1rem 1.5rem; cursor: default;">
                    <div style="font-size: 2rem;">üéØ</div>
                    <div id="badge-total-count"
                        style="font-size: 1.5rem; font-weight: bold; color: var(--primary-light);">0</div>
                    <div style="font-size: 0.85rem; opacity: 0.7;">Total</div>
                </div>
                <div class="hero-card mini" style="padding: 1rem 1.5rem; cursor: default;">
                    <div style="font-size: 2rem;">üìä</div>
                    <div id="badge-progress-pct"
                        style="font-size: 1.5rem; font-weight: bold; color: var(--warning-color);">0%</div>
                    <div style="font-size: 0.85rem; opacity: 0.7;">Complete</div>
                </div>
            </div>

            <div class="achievements-container" style="max-width: 900px; margin: 0 auto; padding: 0 20px;">
                <!-- Short-Term -->
                <div class="trophy-tier" id="tier-short">
                    <h2 class="tier-heading">‚≠ê Quick Wins</h2>
                    <p class="tier-desc">Get started on your learning journey!</p>
                    <div class="trophy-grid" id="grid-short"></div>
                </div>

                <!-- Medium-Term -->
                <div class="trophy-tier" id="tier-medium">
                    <h2 class="tier-heading">üî• Dedication</h2>
                    <p class="tier-desc">Show your commitment through regular practice!</p>
                    <div class="trophy-grid" id="grid-medium"></div>
                </div>

                <!-- Long-Term -->
                <div class="trophy-tier" id="tier-long">
                    <h2 class="tier-heading">üíé Mastery</h2>
                    <p class="tier-desc">The ultimate achievements for true champions!</p>
                    <div class="trophy-grid" id="grid-long"></div>
                </div>
            </div>
        </section>

    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="fun-loader"></div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="control-btn" id="close-settings">‚ùå</button>
            </div>

            <div class="settings-body" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <!-- Column 1 -->
                <div>
                    <!-- LLM Settings -->
                    <div class="settings-group">
                        <h3>Story Engine (AI)</h3>
                        <div class="settings-options-grid" id="llm-options">
                            <!-- Items injected by JS -->
                        </div>
                    </div>

                    <!-- TTS Settings -->
                    <div class="settings-group">
                        <h3>Voice (TTS)</h3>
                        <div class="settings-options-grid" id="tts-options">
                            <!-- Items injected by JS -->
                        </div>
                    </div>

                </div> <!-- End Column 1 -->

                <!-- Column 2 -->
                <div>
                    <!-- Voice Preset -->
                    <div class="settings-group">
                        <h3>Voice Tone</h3>
                        <div class="settings-options-grid" id="voice-preset-options">
                            <div class="settings-option selected" data-value="default">
                                <span class="option-label">Child Friendly (Soft)</span>
                            </div>
                            <div class="settings-option" data-value="ana">
                                <span class="option-label">Ana (Sweet)</span>
                            </div>
                            <div class="settings-option" data-value="aria">
                                <span class="option-label">Aria (Clear)</span>
                            </div>
                            <div class="settings-option" data-value="guy">
                                <span class="option-label">Guy (Male)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Story Tone -->
                    <div class="settings-group">
                        <h3>Story Style</h3>
                        <div class="settings-options-grid" id="tone-options">
                            <div class="settings-option selected" data-value="default">
                                <span class="option-label">Normal</span>
                            </div>
                            <div class="settings-option" data-value="happy">
                                <span class="option-label">Super Happy</span>
                            </div>
                            <div class="settings-option" data-value="calm">
                                <span class="option-label">Calm & Gentle</span>
                            </div>
                            <div class="settings-option" data-value="funny">
                                <span class="option-label">Silly & Funny</span>
                            </div>
                        </div>
                    </div>

                    <!-- Reader Layout -->
                    <div class="settings-group">
                        <h3>Reader Layout</h3>
                        <div class="settings-options-grid" id="reader-layout-options">
                            <div class="settings-option selected" data-value="classic">
                                <span class="option-label">Classic</span>
                                <span style="font-size: 0.8rem; color: var(--text-secondary);">One image, full story,
                                    auto-play</span>
                            </div>
                            <div class="settings-option" data-value="step_by_step">
                                <span class="option-label">Step-by-step</span>
                                <span style="font-size: 0.8rem; color: var(--text-secondary);">One sentence at a time,
                                    kid
                                    clicks Next</span>
                            </div>
                        </div>
                    </div>

                    <!-- API Keys -->
                    <div class="settings-group">
                        <h3>API Keys (.env)</h3>
                        <div class="settings-options-grid" style="gap: 10px;">
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9rem;">Google API Key
                                    (Gemini)</label>
                                <input type="password" id="settings-google-key" class="chat-input"
                                    placeholder="AIzaSy..." style="width: 100%; margin-top: 5px; padding: 0.8rem;">
                            </div>
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9rem;">OpenAI API Key</label>
                                <input type="password" id="settings-openai-key" class="chat-input" placeholder="sk-..."
                                    style="width: 100%; margin-top: 5px; padding: 0.8rem;">
                            </div>
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9rem;">Groq API Key</label>
                                <input type="password" id="settings-groq-key" class="chat-input" placeholder="gsk_..."
                                    style="width: 100%; margin-top: 5px; padding: 0.8rem;">
                            </div>
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9rem;">Hugging Face
                                    Token</label>
                                <input type="password" id="settings-hf-token" class="chat-input" placeholder="hf_..."
                                    style="width: 100%; margin-top: 5px; padding: 0.8rem;">
                            </div>
                        </div>
                    </div>

                </div> <!-- End Column 2 -->
            </div>

            <div class="text-center mt-3" style="grid-column: 1 / -1;">
                <button id="save-settings-btn" class="control-btn primary">Save Changes</button>
            </div>
        </div>
    </div>

    <script src="/js/app.js"></script>
</body>

</html>